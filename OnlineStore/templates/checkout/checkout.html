{% extends 'base.html' %}

{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static "assets/css/checkout.css"%}" />
{% endblock %}

{% block content %}
<h1 style="text-align: center;">Оформление заказа</h1>
{% if messages %}
<div class="messages-container">
  <ul class="messages">
    {% for message in messages %}
      <div {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</div>
    {% endfor %}
  </ul>
</div>
{% endif %}

<form method="post" action="{% url 'checkout:create_order'%}">
  {% csrf_token %}
  <section>
    <div class="row" style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
      
      <!-- Доставка -->
      <div class="col-md-8" style="width: 100%; max-width: 600px;">
        <h2>Доставка</h2>
        {% for field in form %}
          {% if field.name != 'payment_method' %}
            <div class="form-group">
              {{ field }}
              <div class="text-danger error-message">
                {% for error in field.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <!-- Ваш заказ -->
      <div class="col-md-8" style="width: 100%; max-width: 600px;">
        <h2>Ваш заказ</h2>
        {% if cart.items.exists %}
          <div class="table-wrapper">
            <table class="alt">
              <thead>
                <tr>
                  <th>Название</th>
                  <th>Количество</th>
                  <th>Цена</th>
                </tr>
              </thead>
              <tbody>
                {% for cart_item in cart.items.all %}
                <tr>
                  <td>{{ cart_item.item.title|truncatechars:20 }}</td>
                  <td>{{ cart_item.quantity }}</td>
                  <td>{{ cart_item.total_price }}</td>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="2"></td>
                  <td><b>{{ cart.total_price }}</b></td>
                </tr>
              </tfoot>
            </table>
          </div>
        {% else %}
          Корзина пустая
          <a href="{% url 'store:home' %}" class="button" style="display: block; text-align: center; margin-top: 20px;">Вернуться на главную</a>
        {% endif %}
      </div>

      <!-- Способ оплаты -->
      <div class="col-md-8" style="width: 100%; max-width: 600px;">
        <h2>Выберите способ оплаты</h2>
        {{ form.payment_method }}
        {% include 'checkout/popup.html' %}
      </div>
      
    </div>
  </section>

  <!-- Кнопки -->
  <div class="actions" style="display: flex; flex-direction: column; align-items: center; margin-top: 40px; gap: 10px;">
    <input type="reset" value="Сбросить" class="button" style="width: 100%; max-width: 300px;">
    {% if cart.items.exists %}
      <input type="submit" value="Оставить заказ" class="primary button" style="width: 100%; max-width: 300px;">
    {% else %}
      <input type="submit" value="Оставить заказ" class="primary disabled button" style="width: 100%; max-width: 300px;">
    {% endif %}
  </div>
</form>
{% endblock %}

{% block js %}
<script src={% static "assets/js/checkout.js"%}></script>
<!-- PayPal JavaScript SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=test&currency=USD"></script>
<script src={% static "assets/js/payment.js"%}></script>
{% endblock %}
